
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Multiplicative Weights Exponential Mechanism (MWEM) &#8212; OpenDP SmartNoise Synthesizers</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/blank.css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Maximum Spanning Tree (MST)" href="mst.html" />
    <link rel="prev" title="Synthesizer Reference" href="index.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="http://docs.smartnoise.org">
  <img src="../_static/smartnoise-logo.svg" class="logo" alt="logo">
</a>


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="index.html">
  Synthesizers Index
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../transforms/index.html">
  Data Transformers Index
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/opendp/smartnoise-sdk" rel="noopener" target="_blank" title="GitHub">
            <span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://twitter.com/opendp_org" rel="noopener" target="_blank" title="Twitter">
            <span><i class="fab fa-twitter-square"></i></span>
            <label class="sr-only">Twitter</label>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/opendp/opendp/discussions" rel="noopener" target="_blank" title="GitHub Discussions">
            <span><i class="far fa-comments"></i></span>
            <label class="sr-only">GitHub Discussions</label>
          </a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar"><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   MWEM
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="mst.html">
   MST
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="pac_synth.html">
   PAC-Synth
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="dpctgan.html">
   DP-CTGAN
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="patectgan.html">
   PATE-CTGAN
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="pategan.html">
   PATE-GAN
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="dpgan.html">
   DP-GAN
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="quail.html">
   QUAIL
  </a>
 </li>
</ul>

  </div>
</nav>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#parameters">
   Parameters
  </a>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <section id="multiplicative-weights-exponential-mechanism-mwem">
<h1>Multiplicative Weights Exponential Mechanism (MWEM)<a class="headerlink" href="#multiplicative-weights-exponential-mechanism-mwem" title="Permalink to this headline">¶</a></h1>
<p>Multiplicative Weights Exponential Mechanism.  From “<a class="reference external" href="https://www.cs.huji.ac.il/~katrina//papers/mwem-nips.pdf">A Simple and Practical Algorithm for Differentially Private Data Release</a>”.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">snsynth</span> <span class="kn">import</span> <span class="n">Synthesizer</span>

<span class="n">pums</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;PUMS.csv&quot;</span><span class="p">)</span>
<span class="n">synth</span> <span class="o">=</span> <span class="n">Synthesizer</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;mwem&quot;</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">synth</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">pums</span><span class="p">,</span> <span class="n">preprocessor_eps</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<span class="n">pums_synth</span> <span class="o">=</span> <span class="n">synth</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
<p>MWEM maintains an in-memory copy of the full joint distribution, initialized to a uniform distribution, and updated with each iteration.  The size of the joint distribution in memory is the product of the cardinalities of columns of the input data, which may be much larger than the number of rows.  For example, in the code above, the dimensionality inferred will be about 300,000 cells, and training will take several minutes.  In the PUMS dataset with income column dropped, the size of the in-memory histogram is 29,184 cells.  The size of the histogram can explode rapidly with multiple columns with high cardinality.  You can provide splits to divide the columns into independent subsets, which may dramatically reduce the memory requirement. In the code below, MWEM will split the data into multiple disjoint cubes with 3 columns each (per the <code class="docutils literal notranslate"><span class="pre">split_factor</span></code> argument), and train a separate model for each cube.  The size of the in-memory histogram will be lower than 3,000 cells, and training will be relatively fast.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">snsynth</span> <span class="kn">import</span> <span class="n">Synthesizer</span>

<span class="n">pums</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;PUMS.csv&quot;</span><span class="p">)</span>
<span class="n">synth</span> <span class="o">=</span> <span class="n">Synthesizer</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;mwem&quot;</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">split_factor</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">synth</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">pums</span><span class="p">,</span> <span class="n">preprocessor_eps</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<span class="n">pums_synth</span> <span class="o">=</span> <span class="n">synth</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
<p>The MWEM algorithm operates by alternating between a step that selects a poorly-performing query via exponential mechanism, and then updating the estimated joint distribution via the laplace mechanism, to perform better on the selected query.  Over multiple iterations, the estimated joint distribution will become better at answering the selected workload of queries.</p>
<p>Because of this, the performance of MWEM is highly dependent on the quality of the candidate query workload.  The implementation tries to generate a query workload that will perform well.  You can provide some hints to influence the candidate queries.  By default, MWEM will generate workloads with all one-way and two-way marginals.  If you want to ensure three-way or higher marginals are candidates, you can use <code class="docutils literal notranslate"><span class="pre">marginal_width</span></code>.  In cases where columns contain ordinal data, particularly in columns that are binned from continuous values, you can use <code class="docutils literal notranslate"><span class="pre">add_ranges</span></code> to ensure that candidate queries include range queries.  If range queries are more important that two-way marginals, for example, you can combine <code class="docutils literal notranslate"><span class="pre">add_ranges</span></code> with a <code class="docutils literal notranslate"><span class="pre">marginal_width=1</span></code> to suppress two-way marginals.</p>
<p>Each iteration spends a fraction of the budgeted epsilon.  Very large numbers of iterations may divide the epsilon too small, resulting in large measurement error on each measurement.  Conversely, using too few iterations will reduce error of individual measurements, but may interefere with the algorithm converging.  For example, if your data set has 15 total one-way and two-way cuboids, and you use iterations=15, every cuboid will be measured with the maximum possible epsilon, but the fit may be poor.</p>
<p>By default, the implementation chooses a number of iterations based on the size of the data.  The number of candidate queries generated will be based on the number of iterations, and will focus on marginals, unless <code class="docutils literal notranslate"><span class="pre">add_ranges</span></code> is specified.  You can also specify a <code class="docutils literal notranslate"><span class="pre">q_count</span></code> to ensure that a certain number of candidate queries is always generated, regardless of the number of iterations.  This can be useful when you care more about range queries than marginals, because range queries each touch a single slice, while marginal cuboids may update hundreds or thousands of slices.</p>
<p>If you are confident that the candidate query workload is high quality, you can use <code class="docutils literal notranslate"><span class="pre">measure_only</span></code> to skip the query selection step, and just sample uniformly from the workload.  This can double the budget available to measure the queries, but typically is not useful for anything but the smallest datasets.</p>
<section id="parameters">
<h2>Parameters<a class="headerlink" href="#parameters" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="snsynth.mwem.MWEMSynthesizer">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">snsynth.mwem.</span></span><span class="sig-name descname"><span class="pre">MWEMSynthesizer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">epsilon</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3.0</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">ignore</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">q_count</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">iterations</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">splits</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">split_factor</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">marginal_width</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">add_ranges</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">measure_only</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_retries_exp_mechanism</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">10</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mult_weights_iterations</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">20</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/snsynth/mwem.html#MWEMSynthesizer"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#snsynth.mwem.MWEMSynthesizer" title="Permalink to this definition">¶</a></dt>
<dd><blockquote>
<div><p>N-Dimensional numpy implementation of MWEM.
(<a class="reference external" href="http://users.cms.caltech.edu/~katrina/papers/mwem-nips.pdf">http://users.cms.caltech.edu/~katrina/papers/mwem-nips.pdf</a>)</p>
</div></blockquote>
<p>From the paper:
“[MWEM is] a broadly applicable, simple, and easy-to-implement
algorithm, capable of substantially improving the performance of
linear queries on many realistic datasets…
(circa 2012)…MWEM matches the best known and nearly
optimal theoretical accuracy guarantees for differentially private
data analysis with linear queries.”</p>
<p>Linear queries used for sampling in this implementation are
random contiguous slices of the n-dimensional numpy array.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>epsilon</strong> (<em>float</em><em>, </em><em>optional</em>) – Privacy budget.</p></li>
<li><p><strong>q_count</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of random queries in the pool to generate.
Must be more than # of iterations</p></li>
<li><p><strong>iterations</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of iterations of MWEM to run.  MWEM will
guess a reasonable number of iterations if this is not specified.</p></li>
<li><p><strong>splits</strong> (<em>list</em><em>, </em><em>optional</em>) – Allows you to specify feature dependence when creating
internal histograms.
Columns that are known to be dependent can be kept together.
Example: splits=[[0,1],[2,3]] where
columns 0 and 1 are dependent, columns 2 and 3 are dependent,
and between groupings there is independence, defaults to []</p></li>
<li><p><strong>split_factor</strong> (<em>int</em><em>, </em><em>optional</em>) – If splits not specified, can instead subdivide
pseudo-randomly. For example, split_factor=3
will make groupings of features of size 3 for the histograms.
Note: this will likely make synthetic data worse.
defaults to None</p></li>
<li><p><strong>marginal_width</strong> (<em>int</em><em>, </em><em>optional</em>) – MWEM by default will create cuboids to measure
marginals, and will use a heuristic to determine the maximum width
of the marginals.  This parameter allows you to specify that MWEM
should always measure marginals up to width marginal_width.</p></li>
<li><p><strong>add_ranges</strong> – In addition to measuring cuboids, MWEM can measure
randomly generated range queries.  Range queries work well on columns
that are binned from continuous values.</p></li>
<li><p><strong>measure_only</strong> (<em>bool</em><em>, </em><em>optional</em>) – MWEM operates by spending some privacy budget to select
the best query.  This parameter allows you to specify that MWEM should
uniformly measure all queries, and not spend any privacy budget on the
query selection.  This is useful in limited cases.  Allowing MWEM to select
will usually work best.</p></li>
<li><p><strong>max_retries_exp_mechanism</strong> (<em>int</em><em>, </em><em>optional</em>) – In each iteration, MWEM tries to select
a poorly-peforming query that hasn’t yet been measured.  If it fails,
it will select one of the remaining queries uniformly at random.</p></li>
<li><p><strong>mult_weights_iterations</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of iterations of multiplicative weights,
per iteration of MWEM, defaults to 20</p></li>
<li><p><strong>verbose</strong> (<em>bool</em><em>, </em><em>optional</em>) – Set to True to print debug information.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
</section>


              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="index.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Synthesizer Reference</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="mst.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Maximum Spanning Tree (MST)</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
              
          </main>
          

      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2022.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.1.2.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>