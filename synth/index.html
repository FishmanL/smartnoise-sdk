
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>SmartNoise Synthesizers &#8212; OpenDP SmartNoise Synthesizers</title>
    
  <link href="_static/css/theme.css" rel="stylesheet">
  <link href="_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/css/blank.css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    
  <link rel="preload" as="script" href="_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Synthesizers API Reference" href="api/index.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="http://docs.smartnoise.org">
  <img src="_static/smartnoise-logo.svg" class="logo" alt="logo">
</a>


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="api/index.html">
  API index
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/opendp/smartnoise-sdk" rel="noopener" target="_blank" title="GitHub">
            <span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://twitter.com/opendp_org" rel="noopener" target="_blank" title="Twitter">
            <span><i class="fab fa-twitter-square"></i></span>
            <label class="sr-only">Twitter</label>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/opendp/opendp/discussions" rel="noopener" target="_blank" title="GitHub Discussions">
            <span><i class="far fa-comments"></i></span>
            <label class="sr-only">GitHub Discussions</label>
          </a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar"><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    
  </div>
</nav>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#api-reference">
   API Reference
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#getting-started">
   Getting Started
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#mwem">
     MWEM
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dp-ctgan">
     DP-CTGAN
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#pate-ctgan">
     PATE-CTGAN
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#mst">
     MST
    </a>
   </li>
  </ul>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <section id="smartnoise-synthesizers">
<h1>SmartNoise Synthesizers<a class="headerlink" href="#smartnoise-synthesizers" title="Permalink to this headline">¶</a></h1>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title">Table of Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#api-reference" id="id2">API Reference</a></p></li>
<li><p><a class="reference internal" href="#getting-started" id="id3">Getting Started</a></p>
<ul>
<li><p><a class="reference internal" href="#mwem" id="id4">MWEM</a></p></li>
<li><p><a class="reference internal" href="#dp-ctgan" id="id5">DP-CTGAN</a></p></li>
<li><p><a class="reference internal" href="#pate-ctgan" id="id6">PATE-CTGAN</a></p></li>
<li><p><a class="reference internal" href="#mst" id="id7">MST</a></p></li>
</ul>
</li>
</ul>
</div>
<section id="api-reference">
<h2><a class="toc-backref" href="#id2">API Reference</a><a class="headerlink" href="#api-reference" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="api/index.html">API index</a><ul>
<li class="toctree-l2"><a class="reference internal" href="api/index.html#mwem">MWEM</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/index.html#quail">QUAIL</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/index.html#pytorch">PyTorch</a></li>
</ul>
</li>
</ul>
</div>
</section>
<section id="getting-started">
<h2><a class="toc-backref" href="#id3">Getting Started</a><a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h2>
<section id="mwem">
<h3><a class="toc-backref" href="#id4">MWEM</a><a class="headerlink" href="#mwem" title="Permalink to this headline">¶</a></h3>
<p>Multiplicative Weights Exponential Mechanism.  From “<a class="reference external" href="https://www.cs.huji.ac.il/~katrina//papers/mwem-nips.pdf">A Simple and Practical Algorithm for Differentially Private Data Release</a>”.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">snsynth</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">pums</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">pums_csv_path</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="c1"># in datasets/</span>
<span class="n">pums</span> <span class="o">=</span> <span class="n">pums</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;income&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">nf</span> <span class="o">=</span> <span class="n">pums</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="n">synth</span> <span class="o">=</span> <span class="n">snsynth</span><span class="o">.</span><span class="n">MWEMSynthesizer</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">synth</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">nf</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MWEM spent epsilon </span><span class="si">{</span><span class="n">synth</span><span class="o">.</span><span class="n">spent</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">sample</span> <span class="o">=</span> <span class="n">synth</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span>
</pre></div>
</div>
<p>MWEM maintains an in-memory copy of the full joint distribution, initialized to a uniform distribution, and updated with each iteration.  The size of the joint distribution in memory is the product of the cardinalities of columns of the input data, which may be much larger than the number of rows.  For example, in the PUMS dataset with income column dropped, the size of the in-memory histogram is 29,184 cells.  The size of the histogram can explode rapidly with multiple columns with high cardinality.  You can provide splits to divide the columns into independent subsets, which may dramatically reduce the memory requirement.</p>
<p>The MWEM algorithm operates by alternating between a step that selects a poorly-performing query via exponential mechanism, and then updating the estimated joint distribution via the laplace mechanism, to perform better on the selected query.  Over multiple iterations, the estimated joint distribution will become better at answering the selected workload of queries.</p>
<p>Because of this, the performance of MWEM is highly dependent on the quality of the candidate query workload.  The implementation tries to generate a query workload that will perform well.  You can provide some hints to influence the candidate queries.  By default, MWEM will generate workloads with all one-way and two-way marginals.  If you want to ensure three-way or higher marginals are candidates, you can use <code class="docutils literal notranslate"><span class="pre">marginal_width</span></code>.  In cases where columns contain ordinal data, particularly in columns that are binned from continuous values, you can use <code class="docutils literal notranslate"><span class="pre">add_ranges</span></code> to ensure that candidate queries include range queries.  If range queries are more important that two-way marginals, for example, you can combine <code class="docutils literal notranslate"><span class="pre">add_ranges</span></code> with a <code class="docutils literal notranslate"><span class="pre">marginal_width=1</span></code> to suppress two-way marginals.</p>
<p>Each iteration spends a fraction of the budgeted epsilon.  Very large numbers of iterations may divide the epsilon too small, resulting in large measurement error on each measurement.  Conversely, using too few iterations will reduce error of individual measurements, but may interefere with the algorithm converging.  For example, if your data set has 15 total one-way and two-way cuboids, and you use iterations=15, every cuboid will be measured with the maximum possible epsilon, but the fit may be poor.</p>
<p>By default, the implementation chooses a number of iterations based on the size of the data.  The number of candidate queries generated will be based on the number of iterations, and will focus on marginals, unless <code class="docutils literal notranslate"><span class="pre">add_ranges</span></code> is specified.  You can also specify a <code class="docutils literal notranslate"><span class="pre">q_count</span></code> to ensure that a certain number of candidate queries is always generated, regardless of the number of iterations.  This can be useful when you care more about range queries than marginals, because range queries each touch a single slice, while marginal cuboids may update hundreds or thousands of slices.</p>
<p>If you are confident that the candidate query workload is high quality, you can use <code class="docutils literal notranslate"><span class="pre">measure_only</span></code> to skip the query selection step, and just sample uniformly from the workload.  This can double the budget available to measure the queries, but typically is not useful for anything but the smallest datasets.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">debug</span></code> flag prints detailed diagnostics about the query workload generated and convergence status.</p>
</section>
<section id="dp-ctgan">
<h3><a class="toc-backref" href="#id5">DP-CTGAN</a><a class="headerlink" href="#dp-ctgan" title="Permalink to this headline">¶</a></h3>
<p>Conditional tabular GAN with differentially private stochastic gradient descent.  From “<a class="reference external" href="https://arxiv.org/abs/1907.00503">Modeling Tabular data using Conditional GAN</a>”.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">snsynth</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">snsynth.pytorch.nn</span> <span class="kn">import</span> <span class="n">DPCTGAN</span>
<span class="kn">from</span> <span class="nn">snsynth.pytorch</span> <span class="kn">import</span> <span class="n">PytorchDPSynthesizer</span>
<span class="kn">from</span> <span class="nn">snsynth.preprocessors.data_transformer</span> <span class="kn">import</span> <span class="n">BaseTransformer</span>

<span class="n">pums</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">pums_csv_path</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="c1"># in datasets/</span>
<span class="n">pums</span> <span class="o">=</span> <span class="n">pums</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;income&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">synth</span> <span class="o">=</span> <span class="n">PytorchDPSynthesizer</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">DPCTGAN</span><span class="p">())</span>
<span class="n">synth</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">pums</span><span class="p">,</span> <span class="n">categorical_columns</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">pums</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span> <span class="n">transformer</span><span class="o">=</span><span class="n">BaseTransformer</span><span class="p">)</span>

<span class="n">sample</span> <span class="o">=</span> <span class="n">synth</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># synthesize 10 rows</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="pate-ctgan">
<h3><a class="toc-backref" href="#id6">PATE-CTGAN</a><a class="headerlink" href="#pate-ctgan" title="Permalink to this headline">¶</a></h3>
<p>Conditional tabular GAN using Private Aggregation of Teacher Ensembles.  From “<a class="reference external" href="https://openreview.net/pdf?id=S1zk9iRqF7">PATE-GAN: Generating Synthetic Data with Differential Privacy Guarantees</a>” and “<a class="reference external" href="https://arxiv.org/abs/1907.00503">Modeling Tabular data using Conditional GAN</a>”.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">snsynth</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">snsynth.pytorch.nn</span> <span class="kn">import</span> <span class="n">PATECTGAN</span>
<span class="kn">from</span> <span class="nn">snsynth.pytorch</span> <span class="kn">import</span> <span class="n">PytorchDPSynthesizer</span>
<span class="kn">from</span> <span class="nn">snsynth.preprocessors.data_transformer</span> <span class="kn">import</span> <span class="n">BaseTransformer</span>

<span class="n">pums</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">pums_csv_path</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="c1"># in datasets/</span>
<span class="n">pums</span> <span class="o">=</span> <span class="n">pums</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;income&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">synth</span> <span class="o">=</span> <span class="n">PytorchDPSynthesizer</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">PATECTGAN</span><span class="p">(</span><span class="n">regularization</span><span class="o">=</span><span class="s1">&#39;dragan&#39;</span><span class="p">))</span>
<span class="n">synth</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">pums</span><span class="p">,</span> <span class="n">categorical_columns</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">pums</span><span class="o">.</span><span class="n">columns</span><span class="p">),</span> <span class="n">transformer</span><span class="o">=</span><span class="n">BaseTransformer</span><span class="p">)</span>

<span class="n">sample</span> <span class="o">=</span> <span class="n">synth</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># synthesize 10 rows</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="mst">
<h3><a class="toc-backref" href="#id7">MST</a><a class="headerlink" href="#mst" title="Permalink to this headline">¶</a></h3>
<p>MST achieves state of the art results for marginals over categorical data, and does well even with small source data.  From McKenna et al. “<a class="reference external" href="https://arxiv.org/abs/2108.04978">Winning the NIST Contest: A scalable and general approach to differentially private synthetic data</a>”</p>
<p>Before using MST, install <a class="reference external" href="pipinstallgit+https://github.com/ryan112358/private-pgm.git">Private-PGM</a> :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip install git+https://github.com/ryan112358/private-pgm.git
</pre></div>
</div>
<p>And call like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">snsynth</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">pums</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">pums_csv_path</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="c1"># in datasets/</span>
<span class="n">pums</span> <span class="o">=</span> <span class="n">pums</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;income&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">Domains</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;pums&quot;</span><span class="p">:</span> <span class="s2">&quot;samples/mst_sample/pums-domain.json&quot;</span><span class="p">}</span> <span class="c1"># in samples/mst_sample</span>
<span class="n">synth</span> <span class="o">=</span> <span class="n">snsynth</span><span class="o">.</span><span class="n">MSTSynthesizer</span><span class="p">(</span><span class="n">domains_dict</span><span class="o">=</span><span class="n">Domains</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="s2">&quot;pums&quot;</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<span class="n">synth</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">pums</span><span class="p">)</span>

<span class="n">sample</span> <span class="o">=</span> <span class="n">synth</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="c1"># synthesize 10 rows</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sample</span><span class="p">)</span>
</pre></div>
</div>
<p>For more, see the <a class="reference external" href="https://github.com/opendp/smartnoise-sdk/tree/main/synth/samples/mst_sample">sample notebook</a></p>
<p>This is version 0.2.7 of the guides, last built on Aug 10, 2022.</p>
</section>
</section>
</section>


              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='right-next' id="next-link" href="api/index.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Synthesizers API Reference</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
              
          </main>
          

      </div>
    </div>
  
  <script src="_static/js/index.be7d3bbb2ef33a8344ce.js"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2022.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.1.2.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>