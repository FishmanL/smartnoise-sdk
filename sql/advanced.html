
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Advanced Usage &#8212; OpenDP SmartNoise SQL</title>
    
  <link href="_static/css/theme.css" rel="stylesheet">
  <link href="_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/css/blank.css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    
  <link rel="preload" as="script" href="_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Metadata" href="metadata.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="http://docs.smartnoise.org">
  <img src="_static/smartnoise-logo.svg" class="logo" alt="logo">
</a>


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="api/index.html">
  API index
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="metadata.html">
  Metadata
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="current reference internal nav-link" href="#">
  Advanced Usage
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/opendp/smartnoise-sdk" rel="noopener" target="_blank" title="GitHub">
            <span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://twitter.com/opendp_org" rel="noopener" target="_blank" title="Twitter">
            <span><i class="fab fa-twitter-square"></i></span>
            <label class="sr-only">Twitter</label>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/opendp/opendp/discussions" rel="noopener" target="_blank" title="GitHub Discussions">
            <span><i class="far fa-comments"></i></span>
            <label class="sr-only">GitHub Discussions</label>
          </a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar"><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    
  </div>
</nav>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#overriding-mechanisms">
   Overriding Mechanisms
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pre-aggregated">
   pre_aggregated
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#postprocess">
   postprocess
  </a>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <section id="advanced-usage">
<h1>Advanced Usage<a class="headerlink" href="#advanced-usage" title="Permalink to this headline">¶</a></h1>
<p>This section covers some advanced usage scenarios.</p>
<section id="overriding-mechanisms">
<h2>Overriding Mechanisms<a class="headerlink" href="#overriding-mechanisms" title="Permalink to this headline">¶</a></h2>
<p>You can override the default mechanisms used for differentially private summary statistics.  The mechanisms are specified in the <code class="docutils literal notranslate"><span class="pre">mechanisms.map</span></code> dictionary on the <code class="docutils literal notranslate"><span class="pre">Privacy</span></code> object.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">snsql</span> <span class="kn">import</span> <span class="n">Privacy</span><span class="p">,</span> <span class="n">Stat</span><span class="p">,</span> <span class="n">Mechanism</span>

<span class="n">privacy</span> <span class="o">=</span> <span class="n">Privacy</span><span class="p">(</span><span class="n">epsilon</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;We default to using </span><span class="si">{</span><span class="n">privacy</span><span class="o">.</span><span class="n">mechanisms</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="n">Stat</span><span class="o">.</span><span class="n">count</span><span class="p">]</span><span class="si">}</span><span class="s2"> for counts.&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Switching to use gaussian&quot;</span><span class="p">)</span>
<span class="n">privacy</span><span class="o">.</span><span class="n">mechanisms</span><span class="o">.</span><span class="n">map</span><span class="p">[</span><span class="n">Stat</span><span class="o">.</span><span class="n">count</span><span class="p">]</span> <span class="o">=</span> <span class="n">Mechanism</span><span class="o">.</span><span class="n">gaussian</span>
</pre></div>
</div>
<p>The list of statistics that can be mapped is in the <code class="docutils literal notranslate"><span class="pre">Stat</span></code> enumeration, and the mechanisms available are listed in the <code class="docutils literal notranslate"><span class="pre">Mechanism</span></code> enumeration.  The <code class="docutils literal notranslate"><span class="pre">AVG</span></code> sumamry statistic is computed from a sum and a count, each of which can be overriden.</p>
<p>For integer sums, you can specify <code class="docutils literal notranslate"><span class="pre">Stat.sum_int</span></code>, and specify <code class="docutils literal notranslate"><span class="pre">Stat.sum_large_int</span></code> separately for large integer sums.  A “large” integer sum is any sum that is greater than the value set in <code class="docutils literal notranslate"><span class="pre">mechanisms.large</span></code>, which defaults to 1000.  This is primarily useful when using geometric mechanism for integer sums, since the geometric mechanism slows down for large integer sums.</p>
</section>
<section id="pre-aggregated">
<h2>pre_aggregated<a class="headerlink" href="#pre-aggregated" title="Permalink to this headline">¶</a></h2>
<p>By default, <code class="docutils literal notranslate"><span class="pre">execute()</span></code> uses the underlying database engine to compute exact aggregates.
You can pass in exact aggregates from a different source, using the <code class="docutils literal notranslate"><span class="pre">pre_aggregated</span></code> parameter.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="s1">&#39;SELECT sex, COUNT(*) AS n, AVG(age) AS age FROM PUMS.PUMS GROUP BY sex ORDER BY sex&#39;</span>

<span class="n">pre_agg</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="s1">&#39;sex&#39;</span><span class="p">,</span> <span class="s1">&#39;sum_age&#39;</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">510</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="mi">23500</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">490</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="mi">21000</span><span class="p">]</span>
<span class="p">]</span>

<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">pre_aggregated</span><span class="o">=</span><span class="n">pre_agg</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[[</span><span class="s1">&#39;sex&#39;</span>, <span class="s1">&#39;n&#39;</span>, <span class="s1">&#39;age&#39;</span><span class="o">]</span>, <span class="o">[</span><span class="s1">&#39;0&#39;</span>, <span class="m">493</span>, <span class="m">42</span>.33581999011567<span class="o">]</span>, <span class="o">[</span><span class="s1">&#39;1&#39;</span>, <span class="m">511</span>, <span class="m">44</span>.43093430694777<span class="o">]]</span>
<span class="o">[[</span><span class="s1">&#39;sex&#39;</span>, <span class="s1">&#39;n&#39;</span>, <span class="s1">&#39;age&#39;</span><span class="o">]</span>, <span class="o">[</span><span class="s1">&#39;0&#39;</span>, <span class="m">487</span>, <span class="m">43</span>.40306305599861<span class="o">]</span>, <span class="o">[</span><span class="s1">&#39;1&#39;</span>, <span class="m">511</span>, <span class="m">45</span>.90357659295852<span class="o">]]</span>
<span class="o">[[</span><span class="s1">&#39;sex&#39;</span>, <span class="s1">&#39;n&#39;</span>, <span class="s1">&#39;age&#39;</span><span class="o">]</span>, <span class="o">[</span><span class="s1">&#39;0&#39;</span>, <span class="m">488</span>, <span class="m">43</span>.11059968286903<span class="o">]</span>, <span class="o">[</span><span class="s1">&#39;1&#39;</span>, <span class="m">506</span>, <span class="m">46</span>.21407160686184<span class="o">]]</span>
</pre></div>
</div>
<p>In this example, the query will skip the database and add noise to <code class="docutils literal notranslate"><span class="pre">pre_agg</span></code> directly.
Each run will add different noise.  You can pass in any iterable over tuples.</p>
<p>Note that the exact aggregates provide a SUM instead of an AVG.  This is because SmartNoise computes AVG
from a noisy COUNT and a noisy SUM.  The <code class="docutils literal notranslate"><span class="pre">execute()</span></code> method expects the <code class="docutils literal notranslate"><span class="pre">pre_aggregated</span></code> values
to match what would be obtained by running the query against an underlying database engine.</p>
<p>You can see which columns are expected by checking the AST of the rewritten query:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="s1">&#39;SELECT sex, COUNT(*) AS n, AVG(age) AS age FROM PUMS.PUMS GROUP BY sex ORDER BY sex&#39;</span>

<span class="n">subquery</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">_rewrite</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
<span class="n">expressions</span> <span class="o">=</span> <span class="p">[</span>
    <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">col</span><span class="o">.</span><span class="n">expression</span><span class="p">)</span><span class="si">}</span><span class="s1"> AS </span><span class="si">{</span><span class="n">col</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">subquery</span><span class="o">.</span><span class="n">select</span><span class="o">.</span><span class="n">namedExpressions</span>
<span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">expressions</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">[</span><span class="s1">&#39;COUNT ( * )&#39;</span>, <span class="s1">&#39;sex&#39;</span>, <span class="s1">&#39;SUM ( age )&#39;</span><span class="o">]</span>
</pre></div>
</div>
<p>Here we see that the first column is <code class="docutils literal notranslate"><span class="pre">COUNT(*)</span></code>, the second is <code class="docutils literal notranslate"><span class="pre">sex</span></code> and the third is <code class="docutils literal notranslate"><span class="pre">SUM(age)</span></code></p>
</section>
<section id="postprocess">
<h2>postprocess<a class="headerlink" href="#postprocess" title="Permalink to this headline">¶</a></h2>
<p>Several query operations do not affect privacy, because they happen after noise has been applied.
Examples include clamping negative counts, TOP/LIMIT, HAVING, and ORDER BY.  Computations such as AVG
are also performed on noisy values in post-processing.  Since the post-processing happens
after noise addition, caching layers may wish to extend budget by caching results
immediately before post-processing.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="s1">&#39;SELECT sex, COUNT(*) AS n FROM PUMS.PUMS GROUP BY sex&#39;</span>
<span class="n">no_pp</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">postprocess</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">no_pp</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[[</span><span class="mf">485.4821800946391</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mf">511.22682440467884</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>
</pre></div>
</div>
<p>Here we see that the counts have not been clamped to be integers, and the columns are ordered differently from the outer SELECT.  However, the counts are noisy, and <code class="docutils literal notranslate"><span class="pre">censor_dims</span></code> has been applied, so this result is suitable for caching and using in post-processing.</p>
<p>Note that the noisy counts are floats, because <code class="docutils literal notranslate"><span class="pre">censor_dims</span></code> is <code class="docutils literal notranslate"><span class="pre">True</span></code> by default.  If the metadata
had specified <code class="docutils literal notranslate"><span class="pre">censor_dims=False</span></code>, then the geometric mechanism would be used for these specific counts, and the values would be integers.</p>
<p>Here is a more complex example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="s1">&#39;SELECT TOP 2 educ, AVG(age) AS age FROM PUMS.PUMS GROUP BY educ ORDER BY age DESC&#39;</span>

<span class="n">no_pp</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">postprocess</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">no_pp</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[[</span><span class="mf">34.429285994199816</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1679</span><span class="p">],</span> <span class="p">[</span><span class="mf">13.966503517008807</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">640</span><span class="p">],</span> <span class="p">[</span><span class="mf">39.30000608265984</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1757</span><span class="p">],</span> <span class="p">[</span><span class="mf">17.211438317953128</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">888</span><span class="p">],</span> <span class="p">[</span><span class="mf">24.727002841061243</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">845</span><span class="p">],</span> <span class="p">[</span><span class="mf">18.247455233675588</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">869</span><span class="p">],</span> <span class="p">[</span><span class="mf">28.619036170132635</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">776</span><span class="p">],</span> <span class="p">[</span><span class="mf">50.41413180280105</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">2067</span><span class="p">],</span> <span class="p">[</span><span class="mf">200.23507699829014</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">8954</span><span class="p">],</span> <span class="p">[</span><span class="mf">58.75871160176575</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">2483</span><span class="p">],</span> <span class="p">[</span><span class="mf">165.14751392246907</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">7151</span><span class="p">],</span> <span class="p">[</span><span class="mf">75.87011805331791</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">3326</span><span class="p">],</span> <span class="p">[</span><span class="mf">178.57055363635266</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">8737</span><span class="p">],</span> <span class="p">[</span><span class="mf">52.596166495791834</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">2650</span><span class="p">],</span> <span class="p">[</span><span class="mf">23.02440993754067</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">1311</span><span class="p">],</span> <span class="p">[</span><span class="mf">14.743632346849909</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">305</span><span class="p">]]</span>
</pre></div>
</div>
<p>Here we notice several things.  The counts are noisy and the <code class="docutils literal notranslate"><span class="pre">educ</span></code> values are not sorted in descending order.
The third column has a SUM instead of an AVG.  And the LIMIT is not applied.  But this rowset is differentially private, and
has everything necessary for post-processing.</p>
<p>The output when <code class="docutils literal notranslate"><span class="pre">postprocess=False</span></code> is the same as the input required for <code class="docutils literal notranslate"><span class="pre">pre_aggregated</span></code>.
This allows patterns like the following:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">query</span> <span class="o">=</span> <span class="s1">&#39;SELECT TOP 2 educ, AVG(age) AS age FROM PUMS.PUMS GROUP BY educ ORDER BY age DESC&#39;</span>

<span class="n">no_pp</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">postprocess</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">pre_aggregated</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">no_pp</span><span class="p">))</span> <span class="c1"># postprocess=True</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[[</span><span class="s1">&#39;educ&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="mf">69.56647634418115</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;4&#39;</span><span class="p">,</span> <span class="mf">63.23184623593364</span><span class="p">]]</span>
<span class="p">[[</span><span class="s1">&#39;educ&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;4&#39;</span><span class="p">,</span> <span class="mf">50.32885468901986</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;16&#39;</span><span class="p">,</span> <span class="mf">49.724923251737366</span><span class="p">]]</span>
<span class="p">[[</span><span class="s1">&#39;educ&#39;</span><span class="p">,</span> <span class="s1">&#39;age&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;6&#39;</span><span class="p">,</span> <span class="mf">54.17627519853133</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="mf">52.93913290533175</span><span class="p">]]</span>
</pre></div>
</div>
<p>In this example, <code class="docutils literal notranslate"><span class="pre">no_pp</span></code> holds differentially private values, so <code class="docutils literal notranslate"><span class="pre">pre_aggregated</span></code> is
not actually the exact aggregates, but instead can be thought of as a simulated version of the
exact aggregates.  The loop runs multiple releases, adding noise each time, without
affecting the privacy cost of the original query.  This can be useful in cases
where you want to estimate error ranges via simulation without querying the exact aggregates
repeatedly.  It can also be useful when caching results to avoid spending budget.  For example,
in the above, the caller could do sequential queries with different LIMIT or ORDER BY,
without spending additional budget.  Queries for SUM (not requested in the original query) could
also be answered with no additional privacy cost.</p>
<p>Note that the result of <code class="docutils literal notranslate"><span class="pre">postprocess=False</span></code> will ensure that rare dimensions are censored,
to ensure that the result is differentially private.  Passing this result back in as
<code class="docutils literal notranslate"><span class="pre">pre_aggregated</span></code> could result in additional dimensions near the threshold being
censored, because noise will be added again.  This may or may not be desirable, depending on your
application.  For example, if you are trying to estimate error ranges, you may want
to set <code class="docutils literal notranslate"><span class="pre">censor_dims=False</span></code> when generating the <code class="docutils literal notranslate"><span class="pre">postprocess=False</span></code> result, and then
set <code class="docutils literal notranslate"><span class="pre">censor_dims=True</span></code> on each of the simulated runs.</p>
</section>
</section>


              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="metadata.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Metadata</p>
        </div>
    </a>
</div>
              
          </main>
          

      </div>
    </div>
  
  <script src="_static/js/index.be7d3bbb2ef33a8344ce.js"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2022.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.1.2.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>